import React, { useRef, useState } from 'react'
import { Button, Linking, StyleSheet, Text, TextInput, View } from 'react-native'
import HomeButton from '../homepage/HomeButton'
import openMap from 'react-native-open-maps';


    let dotmarkers = JSON.parse(`[{"lat":44.319853,"lng":-91.913504,"title":"Alma service center                     \\n407 S. 2nd Street                       \\nAlma,WI,54610"},{"lat":45.161503,"lng":-89.153877,"title":"Antigo service center                   \\n2124 Clermont Street                    \\nAntigo,WI,54409"},{"lat":44.296663,"lng":-88.417186,"title":"Appleton service center                 \\n711 W. Association Drive                \\nAppleton,WI,54914"},{"lat":46.575648,"lng":-90.90998,"title":"Ashland service center                  \\n2501 Golf Course Road                   \\nAshland,WI,54806"},{"lat":45.933009,"lng":-90.45233,"title":"Park Falls service center               \\n330 S. 4th Avenue                       \\nPark Falls,WI,54552"},{"lat":46.46327,"lng":-90.195581,"title":"Hurley service center                   \\n1200 State Hwy 51N                      \\nHurley,WI,54534"},{"lat":46.566017,"lng":-91.415527,"title":"Iron River service center               \\n7615 Railroad Street                    \\nIron River,WI,54847"},{"lat":46.0202,"lng":-91.475553,"title":"Hayward service center                  \\n15614 Windrose Lane, Suite 340          \\nHayward,WI,54843"},{"lat":43.452907,"lng":-88.807962,"title":"Beaver Dam service center               \\nN7146 E. Plaza Drive                    \\nBeaver Dam,WI,53916"},{"lat":42.523054,"lng":-88.989075,"title":"Beloit service center                   \\n1900 Sutler Avenue                      \\nBeloit,WI,53511"},{"lat":45.568818,"lng":-88.903356,"title":"Crandon service center                  \\n110 S. Lake Avenue                      \\nCrandon,WI,54520"},{"lat":44.863928,"lng":-91.464808,"title":"Eau Claire service center               \\n3115 Melby Street                       \\nEau Claire,WI,54703"},{"lat":44.793786,"lng":-91.507697,"title":"Eau Claire South service center         \\nEau Claire State Office Building        \\n718 W. Clairemont Avenue                \\nEau Claire,WI,54701"},{"lat":42.65832,"lng":-88.539022,"title":"Elkhorn service center                  \\n835 S. Lincoln Street                   \\nElkhorn,WI,53121"},{"lat":45.913795,"lng":-89.255913,"title":"Eagle River service center              \\n302 W. Pine Street                      \\nEagle River,WI,54521"},{"lat":43.759933,"lng":-88.477702,"title":"Fond du Lac service center              \\n833 S. Rolling Meadows Drive            \\nFond du Lac,WI,54937"},{"lat":44.021471,"lng":-88.152949,"title":"Chilton service center                  \\n104 Southside Shopping Center           \\n(on Chestnut Street)                    \\nChilton,WI,53014"},{"lat":44.478512,"lng":-88.076269,"title":"Green Bay service center                \\n942 Vanderperren Way                    \\nGreen Bay,WI,54304"},{"lat":44.94685,"lng":-92.710449,"title":"Hudson service center                   \\nBusiness Park, Suite 100                \\n2100 O'Neil Road                        \\nHudson,WI,54016"},{"lat":45.122383,"lng":-92.536636,"title":"New Richmond service center             \\nCivic Center                            \\n156 E. 1st Street                       \\nNew Richmond,WI,54017"},{"lat":42.671621,"lng":-88.97265,"title":"Janesville service center               \\n645 S. Wright Road                      \\nJanesville,WI,53546"},{"lat":42.602978,"lng":-89.659378,"title":"Monroe service center                   \\n815 1st Avenue                          \\nMonroe,WI,53566"},{"lat":42.592382,"lng":-87.91381,"title":"Kenosha service center                  \\n4911 88th Avenue, Suite A               \\nKenosha,WI,53144"},{"lat":43.878283,"lng":-91.179099,"title":"La Crosse area service center           \\n9477 Hwy 16 East                        \\nOnalaska,WI,54650"},{"lat":45.47861,"lng":-91.112119,"title":"Ladysmith service center                \\nNorth Business Center, Suite 1          \\nN5273 Hwy 27                            \\nLadysmith,WI,54848"},{"lat":45.132367,"lng":-90.331699,"title":"Medford service center                  \\n624 S. 8th Street                       \\nMedford,WI,54451"},{"lat":45.807789,"lng":-91.896988,"title":"Spooner service center                  \\nW7074 Green Valley Road                 \\nSpooner,WI,54801"},{"lat":45.686173,"lng":-90.398799,"title":"Phillips service center                 \\nMunicipal Center                        \\n174 S. Eyder Avenue                     \\nPhillips,WI,54555"},{"lat":44.959759,"lng":-90.933235,"title":"Stanley service center                  \\nFire Hall, 239 E. 1st Avenue            \\nStanley,WI,54768"},{"lat":43.078848,"lng":-89.528795,"title":"Madison West service center             \\n8417 Excelsior Drive                    \\nMadison,WI,53717"},{"lat":42.99407,"lng":-87.912716,"title":"Milwaukee-Central service center        \\n2701 S. Chase Avenue                    \\nMilwaukee,WI,53207"},{"lat":43.125685,"lng":-89.322077,"title":"Madison East service center             \\n2001 Bartillon Drive                    \\nMadison,WI,53704"},{"lat":44.661252,"lng":-90.171262,"title":"Marshfield service center               \\n503 S. Cherry Avenue                    \\nMarshfield,WI,54449"},{"lat":44.947147,"lng":-90.319992,"title":"Abbotsford service center               \\nCity Hall                               \\n203 N. 1st Street                       \\nAbbotsford,WI,54405"},{"lat":43.040462,"lng":-87.919418,"title":"Milwaukee-Downtown service center       \\n819 N. 6th Street                       \\nMilwaukee,WI,53203"},{"lat":45.180418,"lng":-89.687545,"title":"Merrill service center                  \\n100 S. Mill Street, Suite 103           \\nMerrill,WI,54452"},{"lat":43.128193,"lng":-87.954085,"title":"Milwaukee-Northeast service center      \\n6073 N. Teutonia Ave.                   \\nMilwaukee,WI,53209"},{"lat":43.133766,"lng":-88.002226,"title":"Milwaukee-Northwest service center      \\n7301 W. Mill Road                       \\nMilwaukee,WI,53218"},{"lat":44.62878,"lng":-91.967003,"title":"Durand service center                   \\n116 W. Main Street                      \\nDurand,WI,54736"},{"lat":44.731688,"lng":-92.475137,"title":"Ellsworth service center                \\n179 E. Main Street                      \\nEllsworth,WI,54011"},{"lat":44.884125,"lng":-91.89817,"title":"Menomonie service center                \\n393 Red Cedar Street, Suite 7           \\nMenomonie,WI,54751"},{"lat":45.295132,"lng":-92.364614,"title":"Amery service center                    \\n950 Elden Avenue                        \\nAmery,WI,54001"},{"lat":45.055766,"lng":-87.734375,"title":"Peshtigo service center                 \\n101 N. Ogden Road                       \\nPeshtigo,WI,54157"},{"lat":44.886436,"lng":-87.868866,"title":"Oconto service station                  \\n1008 Pecor Street                       \\nOconto,WI,54153"},{"lat":45.919988,"lng":-88.26065,"title":"Florence service center                 \\nWild Rivers Interpretive Center         \\n4793 Forestry Drive                     \\nFlorence,WI,54121"},{"lat":42.92934,"lng":-87.879723,"title":"South Milwaukee service center          \\n1835 College Avenue                     \\nSouth Milwaukee,WI,53172"},{"lat":42.945175,"lng":-87.982635,"title":"Milwaukee-Southwest service center      \\n5500 W. Grange Avenue                   \\nGreendale,WI,53129"},{"lat":44.073604,"lng":-87.692614,"title":"Manitowoc service center                \\n3651 Dewey St.                          \\nManitowoc,WI,54220"},{"lat":44.031719,"lng":-88.591883,"title":"Oshkosh service center                  \\n2301 Omro Road                          \\nOshkosh,WI,54904"},{"lat":42.729792,"lng":-90.448541,"title":"Platteville service center              \\nHighway 151 Industrial Park             \\n31 Means Drive                          \\nPlatteville,WI,53818"},{"lat":42.667446,"lng":-90.130463,"title":"Darlington service center               \\n197 Christensen Drive                   \\nDarlington,WI,53530"},{"lat":42.96516,"lng":-90.134979,"title":"Dodgeville service center               \\nSpringate Mall                          \\n316 W. Spring Street                    \\nDodgeville,WI,53533"},{"lat":43.567818,"lng":-89.472891,"title":"Portage service center                  \\n2888 Village Road                       \\nPortage,WI,53901"},{"lat":43.532925,"lng":-90.023369,"title":"Reedsburg service center                \\nTown Hall                               \\n600 W. Main Street                      \\nReedsburg,WI,53959"},{"lat":43.480492,"lng":-89.769062,"title":"Baraboo service center                  \\n1000 Log Lodge Court                    \\nBaraboo,WI,53913"},{"lat":43.2729,"lng":-89.726402,"title":"Sauk City service center                \\nCommunity Center                        \\n730 Monroe Street                       \\nSauk City,WI,53583"},{"lat":42.714937,"lng":-87.901762,"title":"Racine/Sturtevant service center        \\n9531 Rayne Road                         \\nSturtevant,WI,53177"},{"lat":43.320281,"lng":-90.359732,"title":"Richland Center service center          \\n26136 Executive Lane, Suite A           \\nRichland Center,WI,53581"},{"lat":43.026475,"lng":-91.126083,"title":"Prairie du Chien service center         \\n65 Riverside Square, Suite 6            \\nPrairie du Chien,WI,53821"},{"lat":43.575977,"lng":-90.889633,"title":"Viroqua service center                  \\n1316 N. Main Street                     \\nViroqua,WI,54665"},{"lat":45.634176,"lng":-89.444793,"title":"Rhinelander service center              \\nState DOT Building                      \\n510 Hanson Lake Road                    \\nRhinelander,WI,54501"},{"lat":45.508452,"lng":-91.764298,"title":"Rice Lake service center                \\n735 West Avenue (same as 19th Street)   \\nRice Lake,WI,54868"},{"lat":45.793085,"lng":-92.380764,"title":"Siren service center                    \\n24248 WI-35 70                          \\nUnit A                                  \\nSiren,WI,54872"},{"lat":45.573618,"lng":-92.480861,"title":"Luck service center                     \\nLuck Lions Club                         \\n300 S. 1st Street                       \\nLuck,WI,54853"},{"lat":43.755512,"lng":-87.755088,"title":"Sheboygan service center                \\n3603 Kohler Memorial Drive              \\nSheboygan,WI,53081"},{"lat":44.844982,"lng":-87.366188,"title":"Sturgeon Bay service center             \\nBay Ridge Mall                          \\n1009 Egg Harbor Road                    \\nSturgeon Bay,WI,54235"},{"lat":44.608259,"lng":-87.438419,"title":"Algoma service center                   \\n514 4th Street                          \\nAlgoma,WI,54201"},{"lat":44.780228,"lng":-88.574127,"title":"Shawano service center                  \\n1340 E. Green Bay St. (Hwy 29)          \\nShawano,WI,54166"},{"lat":44.8796,"lng":-88.623269,"title":"Keshena service center                  \\nW2727 Our Children's Road               \\nKeshena,WI,54135"},{"lat":43.38986,"lng":-87.953716,"title":"Saukville service center                \\n501 N. Dekora Woods Blvd.               \\nSaukville,WI,53080"},{"lat":46.734269,"lng":-92.102627,"title":"Superior service center                 \\n1701 N. 4th Street                      \\nSuperior,WI,54880"},{"lat":44.525701,"lng":-89.523371,"title":"Stevens Point service center            \\n1001 Maple Bluff Road                   \\nSuite 2                                 \\nStevens Point,WI,54481"},{"lat":44.000393,"lng":-90.504189,"title":"Tomah service center                    \\n1021 N. Superior Ave.                   \\nTomah,WI,54660"},{"lat":43.964481,"lng":-89.818848,"title":"Adams service center                    \\n478 N. Oak Street                       \\nAdams,WI,53910"},{"lat":43.79608,"lng":-90.073927,"title":"Mauston service center                  \\n318 E. State Street                     \\nMauston,WI,53948"},{"lat":43.891724,"lng":-89.489906,"title":"Westfield service center                \\n438 Industrial Drive                    \\nWestfield,WI,53964"},{"lat":43.398511,"lng":-88.197411,"title":"West Bend service center                \\n1516 W. Paradise Drive                  \\nWest Bend,WI,53095"},{"lat":44.368395,"lng":-91.332285,"title":"Whitehall service center                \\n36270 Tower Drive                       \\nSuite 400                               \\nWhitehall,WI,54773"},{"lat":44.558175,"lng":-90.596424,"title":"Neillsville service center              \\n400 Hewett Street                       \\nNeillsville,WI,54456"},{"lat":44.29568,"lng":-90.833507,"title":"Black River Falls service center        \\n618 E. Main Street(Hwy 54)              \\nBlack River Falls,WI,54615"},{"lat":44.822692,"lng":-89.170243,"title":"Wittenberg service center               \\nCommunity Center                        \\n208 W. Vinal Street                     \\nWittenberg,WI,54499"},{"lat":43.04722,"lng":-88.259257,"title":"Waukesha area service center            \\n2019 Golf Road                          \\nPewaukee,WI,53072"},{"lat":44.356735,"lng":-89.100307,"title":"Waupaca service center                  \\n801 W. Fulton Street                    \\nWaupaca,WI,54981"},{"lat":43.969193,"lng":-88.923515,"title":"Berlin service center                   \\nW832 State Road 91                      \\nBerlin,WI,54923"},{"lat":44.076979,"lng":-89.299294,"title":"Wautoma service center                  \\n715 W. Main Street                      \\nWautoma,WI,54982"},{"lat":44.379982,"lng":-89.843528,"title":"Wisconsin Rapids service center         \\nState Office Building                   \\n1681 2nd Avenue S.                      \\nWisconsin Rapids,WI,54495"},{"lat":43.189887,"lng":-88.740035,"title":"Watertown service center                \\n810 West Street                         \\nWatertown,WI,53094"},{"lat":42.929287,"lng":-88.837326,"title":"Fort Atkinson service center            \\nMunicipal Building                      \\n101 N. Main Street                      \\nFort Atkinson,WI,53538"},{"lat":44.908877,"lng":-89.651935,"title":"Wausau service center                   \\n225051 Rib Mountain Drive               \\nWausau,WI,54401"}]`)

    function rad(x : any) {
        return x * Math.PI / 180;
    }
    function find_closest() {
                Geolocation.getCurrentPosition(info => console.log(info));

                var testmarkers = dotmarkers;
                var lat = 43.04400500000003
                var lng =  -87.90457999999995
                var earthRadius = 3959; //In Miles.
                var distances = []
                var stationListLength=3;
                
                for (let i = 0; i < testmarkers.length; i++) {
                    var mlat = testmarkers[i].lat;
                    var mlng = testmarkers[i].lng;
                    var dLat = rad(mlat - lat);
                    var dLong = rad(mlng - lng);
                    var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(rad(lat))
                            * Math.cos(rad(mlat)) * Math.sin(dLong / 2)
                            * Math.sin(dLong / 2);
                    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                    var distance = earthRadius * c;
                    distances[i] = Distance(i, distance);
                }
                
                distances.sort(function(a, b){
                    return a.distance-b.distance;
                    });   

                
                if (distances.length<stationListLength) {
                    stationListLength = distances.length;

                }
            return(testmarkers[distances[0].index])
    }
    function Distance(index: any, distance: any){
        return {index : index, distance: distance}
    }


async function findAddress(zipCode: string){
   let address = find_closest().title.split("\n")
   //openMap({query:address[1]+address[2]}) 
    return ""
}
const DriversLicence = () => {
    const [address, setAddress] = useState("")
    const [input, setInput] = useState("")
    let search = async ()=>{
        setAddress(await findAddress(input))
    }
    let openMapHandle = () => {
        openMap({query:address})
    }
    return (
        <View>
            <HomeButton/>
            <Text>Drivers Licence</Text>
            <Text>Address: {address}</Text>
            
            <TextInput onSubmitEditing={search} onChangeText={newText => setInput(newText)}></TextInput>
            <Button title="Get DMV address" onPress={search}  />
            {address != "" &&
                <Button title="Open Map" onPress={openMapHandle}  />
            }
        </View>
    )
} 

export default DriversLicence

const styles = StyleSheet.create({
    
})
